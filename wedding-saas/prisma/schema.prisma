generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  firebaseUid   String   @unique @map("firebase_uid")
  email         String   @unique
  name          String?
  phone         String?
  photoUrl      String?  @map("photo_url")
  weddingDate   DateTime? @map("wedding_date")
  partnerName   String?  @map("partner_name")
  role          Role     @default(customer)
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  
  orders        Order[]
  weddingSites  WeddingSite[]
  
  @@index([firebaseUid])
  @@index([email])
  @@map("users")
}

model Venue {
  id              String   @id
  slug            String   @unique
  name            String
  description     String   @db.Text
  price           Decimal  @db.Decimal(12, 2)
  thumbnailUrl    String   @map("thumbnail_url")
  previewGallery  String?  @map("preview_gallery") @db.Json
  configJson      String   @map("config_json") @db.LongText
  mobileConfigJson String? @map("mobile_config_json") @db.LongText
  isActive        Boolean  @default(true) @map("is_active")
  isFeatured      Boolean  @default(false) @map("is_featured")
  sortOrder       Int      @default(0) @map("sort_order")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  orders          Order[]
  weddingSites    WeddingSite[]
  
  @@index([isActive])
  @@index([isFeatured])
  @@map("venues")
}

model Order {
  id                    String   @id @default(uuid())
  userId                Int      @map("user_id")
  firebaseUid           String   @map("firebase_uid")
  venueId               String   @map("venue_id")
  amount                Decimal  @db.Decimal(12, 2)
  discountAmount        Decimal  @default(0) @map("discount_amount")
  finalAmount           Decimal  @map("final_amount")
  status                OrderStatus @default(pending)
  paymentMethod         String?  @map("payment_method")
  paymentToken          String?  @map("payment_token")
  paymentResponse       String?  @map("payment_response") @db.Json
  paidAt                DateTime? @map("paid_at")
  editAccessExpiresAt   DateTime? @map("edit_access_expires_at")
  createdAt             DateTime @default(now()) @map("created_at")
  
  user                  User     @relation(fields: [userId], references: [id])
  venue                 Venue    @relation(fields: [venueId], references: [id])
  weddingSite           WeddingSite?
  
  @@index([userId])
  @@index([firebaseUid])
  @@index([venueId])
  @@index([status])
  @@map("orders")
}

model WeddingSite {
  id              String   @id @default(uuid())
  userId          Int      @map("user_id")
  firebaseUid     String   @map("firebase_uid")
  orderId         String   @unique @map("order_id")
  venueId         String   @map("venue_id")
  slug            String   @unique
  contentJson     String   @map("content_json") @db.LongText
  settingsJson    String?  @map("settings_json") @db.Json
  status          SiteStatus @default(draft)
  publishedAt     DateTime? @map("published_at")
  expiresAt       DateTime? @map("expires_at")
  viewCount       Int      @default(0) @map("view_count")
  rsvpCount       Int      @default(0) @map("rsvp_count")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  user            User     @relation(fields: [userId], references: [id])
  order           Order    @relation(fields: [orderId], references: [id])
  venue           Venue    @relation(fields: [venueId], references: [id])
  rsvps           Rsvp[]
  guestMessages   GuestMessage[]
  
  @@index([slug])
  @@index([firebaseUid])
  @@index([venueId])
  @@index([status])
  @@map("wedding_sites")
}

model Rsvp {
  id              Int      @id @default(autoincrement())
  weddingSiteId   String   @map("wedding_site_id")
  name            String
  phone           String?
  attendance      Attendance
  numberOfGuests  Int      @default(1) @map("number_of_guests")
  message         String?  @db.Text
  createdAt       DateTime @default(now()) @map("created_at")
  
  weddingSite     WeddingSite @relation(fields: [weddingSiteId], references: [id])
  
  @@index([weddingSiteId])
  @@map("rsvps")
}

model GuestMessage {
  id              Int      @id @default(autoincrement())
  weddingSiteId   String   @map("wedding_site_id")
  senderName      String   @map("sender_name")
  message         String   @db.Text
  isPublic        Boolean  @default(true) @map("is_public")
  createdAt       DateTime @default(now()) @map("created_at")
  
  weddingSite     WeddingSite @relation(fields: [weddingSiteId], references: [id])
  
  @@index([weddingSiteId])
  @@map("guest_messages")
}

enum Role {
  customer
  admin
  super_admin
}

enum OrderStatus {
  pending
  paid
  failed
  expired
  refunded
}

enum SiteStatus {
  draft
  published
  expired
}

enum Attendance {
  yes
  no
  maybe
}
